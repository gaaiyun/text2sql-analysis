# Text2SQL Analysis System ğŸš€

> åŸºäº n8n å·¥ä½œæµ + Vanna AI çš„æ™ºèƒ½æ–‡æœ¬è½¬ SQL æ•°æ®åˆ†æç³»ç»Ÿ

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.12+](https://img.shields.io/badge/python-3.12+-blue.svg)](https://www.python.org/downloads/)
[![n8n](https://img.shields.io/badge/n8n-latest-ff6d5a.svg)](https://n8n.io/)

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

Text2SQL Analysis System æ˜¯ä¸€ä¸ªæ™ºèƒ½æ•°æ®åˆ†æç³»ç»Ÿï¼Œå°†è‡ªç„¶è¯­è¨€æŸ¥è¯¢è‡ªåŠ¨è½¬æ¢ä¸º SQL è¯­å¥ï¼Œä»æ•°æ®åº“ä¸­è·å–æ•°æ®å¹¶ç”Ÿæˆä¸“ä¸šçš„åˆ†ææŠ¥å‘Šã€‚ç³»ç»Ÿæ”¯æŒ 5 å¤§æ ¸å¿ƒåœºæ™¯ï¼š

| åœºæ™¯ | æè¿° | è¾“å‡ºæ ¼å¼ |
|------|------|---------|
| ğŸ“Š æ•°æ®æ´å¯Ÿ | æ•°æ®åº“ + ç½‘ç»œ + çŸ¥è¯†åº“èåˆåˆ†æ | Markdown/HTML |
| ğŸŒ åœ°åŒºäº§ä¸šåˆ†æ | åœ°åŒºç»æµ/äº§ä¸š/ä¼ä¸š/æŠ•èµ„åˆ†æ | Markdown/HTML |
| ğŸ­ è¡Œä¸šåˆ†æ | è¡Œä¸šè¶‹åŠ¿/ä¼ä¸š/æŠ€æœ¯/åˆ†å¸ƒåˆ†æ | Markdown/HTML |
| ğŸ“‹ æ‹›å•†æ¸…å• | ä¼ä¸šè¯„ä¼° + ç­›é€‰ä¼˜è´¨ä¼ä¸š | Excel |
| ğŸ“‘ ä¼ä¸šå°½è°ƒæŠ¥å‘Š | ä¼ä¸šå…¨ç»´åº¦è°ƒæŸ¥ + æ¨¡æ¿åŒ¹é… | Word/Markdown |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Text2SQL æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ ç”¨æˆ·è¾“å…¥ â”‚ â†’  â”‚ ä»»åŠ¡åˆ†ç±» â”‚ â†’  â”‚ æ•°æ®æ‰¹é‡ â”‚                â”‚
â”‚  â”‚(è‡ªç„¶è¯­è¨€)â”‚    â”‚(åœºæ™¯è¯†åˆ«)â”‚    â”‚  è·å–   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                        â”‚                â”‚                   â”‚
â”‚                        â†“                â†“                   â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                  â”‚ çŸ¥è¯†åº“  â”‚    â”‚ æ•°æ®åº“  â”‚                â”‚
â”‚                  â”‚ (è§„åˆ™)  â”‚    â”‚ (MySQL) â”‚                â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                        â”‚                â”‚                   â”‚
â”‚                        â†“                â†“                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚Markdown â”‚ â†  â”‚ é›†ä¸­å¤„ç† â”‚ â†  â”‚ ç½‘ç»œæœç´¢ â”‚                â”‚
â”‚  â”‚  è¾“å‡º   â”‚    â”‚(å• Agent)â”‚    â”‚ (å¯é€‰)  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| **å·¥ä½œæµå¼•æ“** | n8n | å¯è§†åŒ–å·¥ä½œæµç¼–æ’ |
| **Text2SQL** | Vanna AI | è®­ç»ƒå¼ SQL ç”Ÿæˆ |
| **LLM** | Qwen3.5 Plus (é˜¿é‡Œäº‘ç™¾ç‚¼) | ä¸­æ–‡ç†è§£ + ä½æˆæœ¬ |
| **æ•°æ®åº“** | MySQL | ä¼ä¸šæ•°æ®ä»“åº“ |
| **å‰ç«¯** | n8n Web UI / Streamlit | äº¤äº’å¼ç•Œé¢ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.12+
- Node.js 18+
- MySQL æ•°æ®åº“
- n8n (è‡ªæ‰˜ç®¡)
- é˜¿é‡Œäº‘ç™¾ç‚¼ API Key

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/gaaiyun/text2sql-analysis.git
cd text2sql-analysis
```

### 2. å®‰è£…ä¾èµ–

```bash
# Python ä¾èµ–
pip install -r requirements.txt

# n8n (å…¨å±€å®‰è£…)
npm install -g n8n
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶é…ç½®æ¨¡æ¿å¹¶å¡«å†™ä½ çš„å‡­è¯ï¼š

```bash
cp config.template.json config.json
```

ç¼–è¾‘ `config.json`ï¼š

```json
{
  "database": {
    "host": "YOUR_DB_HOST",
    "port": 3306,
    "user": "YOUR_DB_USER",
    "password": "YOUR_DB_PASSWORD",
    "database": "YOUR_DB_NAME"
  },
  "bailian": {
    "api_key": "YOUR_DASHSCOPE_API_KEY",
    "base_url": "https://coding.dashscope.aliyuncs.com/v1",
    "model": "qwen3.5-plus"
  },
  "vanna": {
    "api_key": "YOUR_VANNA_API_KEY",
    "org": "your-org"
  }
}
```

### 4. å¯¼å…¥ n8n å·¥ä½œæµ

1. å¯åŠ¨ n8n: `n8n start`
2. è®¿é—® http://localhost:5646
3. ç‚¹å‡» **Settings â†’ Import from File**
4. é€‰æ‹© `n8n_workflow_text2sql.json`

### 5. è®­ç»ƒ Vanna AI

```bash
python scripts/train_vanna.py
```

### 6. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨ Vanna API æœåŠ¡
python api/vanna_server.py

# å¯åŠ¨ n8n
n8n start
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
text2sql-analysis/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ LICENSE                      # MIT è®¸å¯è¯
â”œâ”€â”€ .gitignore                   # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ config.template.json         # é…ç½®æ¨¡æ¿ï¼ˆè„±æ•ï¼‰
â”œâ”€â”€ requirements.txt             # Python ä¾èµ–
â”œâ”€â”€ n8n_workflow_text2sql.json   # n8n å·¥ä½œæµï¼ˆå¯ç›´æ¥å¯¼å…¥ï¼‰
â”‚
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ vanna_server.py          # Vanna API æœåŠ¡
â”‚   â””â”€â”€ text2sql_api.py          # Text2SQL æ¥å£
â”‚
â”œâ”€â”€ prompts/
â”‚   â”œâ”€â”€ scenario_1_data_insight.md       # åœºæ™¯ 1 æç¤ºè¯
â”‚   â”œâ”€â”€ scenario_2_regional_industry.md  # åœºæ™¯ 2 æç¤ºè¯
â”‚   â”œâ”€â”€ scenario_3_industry_analysis.md  # åœºæ™¯ 3 æç¤ºè¯
â”‚   â”œâ”€â”€ scenario_4_investment_list.md    # åœºæ™¯ 4 æç¤ºè¯
â”‚   â””â”€â”€ scenario_5_due_diligence.md      # åœºæ™¯ 5 æç¤ºè¯
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ train_vanna.py           # Vanna è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ extract_schema.py        # Schema æå–
â”‚   â””â”€â”€ test_connection.py       # æ•°æ®åº“è¿æ¥æµ‹è¯•
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ RESEARCH.md              # è°ƒç ”æŠ¥å‘Š
â”‚   â”œâ”€â”€ VANNA_CONFIG.md          # Vanna é…ç½®æ–‡æ¡£
â”‚   â””â”€â”€ N8N_WORKFLOW_RESEARCH.md # n8n å·¥ä½œæµè°ƒç ”
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ test_sql_generation.py   # SQL ç”Ÿæˆæµ‹è¯•
    â””â”€â”€ test_scenarios.py        # åœºæ™¯æµ‹è¯•
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### åœºæ™¯ 1: æ•°æ®æ´å¯Ÿ

**ç”¨æˆ·è¾“å…¥**: "åˆ†æè¿‘ 3 å¹´ä¼ä¸šèèµ„è¶‹åŠ¿"

**ç³»ç»Ÿæµç¨‹**:
1. è¯†åˆ«åœºæ™¯ â†’ æ•°æ®æ´å¯Ÿ
2. ç”Ÿæˆ SQL â†’ æŸ¥è¯¢èèµ„ä¿¡æ¯è¡¨
3. æ•°æ®åˆ†æ â†’ LLM ç”Ÿæˆæ´å¯Ÿ
4. è¾“å‡º â†’ Markdown æŠ¥å‘Š

### åœºæ™¯ 2: åœ°åŒºäº§ä¸šåˆ†æ

**ç”¨æˆ·è¾“å…¥**: "åˆ†æåŒ—äº¬å¸‚äººå·¥æ™ºèƒ½äº§ä¸šå‘å±•æƒ…å†µ"

**ç³»ç»Ÿæµç¨‹**:
1. è¯†åˆ«åœºæ™¯ â†’ åœ°åŒºäº§ä¸š
2. ç”Ÿæˆ SQL â†’ æŸ¥è¯¢åŒ—äº¬ +AI è¡Œä¸šä¼ä¸š
3. å¤šç»´åº¦åˆ†æ â†’ ç»æµ/äº§ä¸š/ä¼ä¸š/æŠ•èµ„
4. è¾“å‡º â†’ å›¾æ–‡æŠ¥å‘Š

### åœºæ™¯ 3: è¡Œä¸šåˆ†æ

**ç”¨æˆ·è¾“å…¥**: "åˆ†ææ–°èƒ½æºæ±½è½¦è¡Œä¸šå‘å±•è¶‹åŠ¿"

### åœºæ™¯ 4: æ‹›å•†æ¸…å•

**ç”¨æˆ·è¾“å…¥**: "è¯„ä¼°ä»¥ä¸‹ä¼ä¸šï¼š[ä¼ä¸šåˆ—è¡¨]"

**è¾“å‡º**: Excel æ ¼å¼ï¼ŒåŒ…å« 8 ä¸ªç»´åº¦è¯„åˆ†

### åœºæ™¯ 5: ä¼ä¸šå°½è°ƒæŠ¥å‘Š

**ç”¨æˆ·è¾“å…¥**: "ç”Ÿæˆ XX ä¼ä¸šå°½è°ƒæŠ¥å‘Š"

**è¾“å‡º**: Word/Markdown æ ¼å¼å®Œæ•´æŠ¥å‘Š

---

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®

ç³»ç»Ÿæ”¯æŒä¸¤ä¸ªæ•°æ®åº“ï¼š

| åœºæ™¯ | ä¸»æœº | ç«¯å£ | æ•°æ®åº“ |
|------|------|------|--------|
| åœºæ™¯ 1-3 | 8.134.9.77 | 3306 | Gaaiyun |
| åœºæ™¯ 4-5 | 8.134.9.77 | 3306 | gaaiyun_2 |

### Vanna AI é…ç½®

Vanna AI éœ€è¦é¢„å…ˆè®­ç»ƒä»¥ç†è§£æ•°æ®åº“ Schemaï¼š

```python
import vanna as vn

# è¿æ¥æ•°æ®åº“
vn.connect_to_mysql(
    host='YOUR_DB_HOST',
    database='YOUR_DB_NAME',
    user='YOUR_DB_USER',
    password='YOUR_DB_PASSWORD'
)

# è®­ç»ƒ
vn.train(ddl="CREATE TABLE ...")
vn.train(document="è¡¨ç»“æ„è¯´æ˜")
vn.train(sql="SELECT ...")
```

---

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/

# æµ‹è¯•æ•°æ®åº“è¿æ¥
python scripts/test_connection.py

# æµ‹è¯• SQL ç”Ÿæˆ
python tests/test_sql_generation.py
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

åŸºäºå®é™…ä½¿ç”¨ç»éªŒï¼Œç³»ç»Ÿé‡‡ç”¨ä»¥ä¸‹ä¼˜åŒ–ç­–ç•¥ï¼š

| ä¼˜åŒ–ç‚¹ | æ–¹æ¡ˆ | æ•ˆæœ |
|--------|------|------|
| **Token æ§åˆ¶** | æ‰¹é‡è·å–â†’é›†ä¸­å¤„ç†â†’åˆ†æ®µè¾“å‡º | å‡å°‘ 60% token æ¶ˆè€— |
| **æ¶æ„è®¾è®¡** | å• Agent é›†ä¸­å¤„ç† | é¿å…å¤šåˆ†æ”¯å†—ä½™ |
| **è¾“å‡ºæ ¼å¼** | Markdown ä¼˜å…ˆ | ç¨³å®šæ€§é«˜ï¼Œå…¼å®¹æ€§å¥½ |
| **Schema å¤„ç†** | ç²¾ç®€æ ¸å¿ƒå­—æ®µ | é¿å… token è¿‡è½½ |
| **çŸ¥è¯†åº“ä½¿ç”¨** | ä»…å­˜è§„åˆ™ï¼Œå¼ºåˆ¶æ•°æ®åº“æŸ¥è¯¢ | æé«˜å‡†ç¡®æ€§ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**: è¯·å‹¿å°† `config.json` ç­‰åŒ…å« API Key çš„æ–‡ä»¶ä¸Šä¼ åˆ°å…¬å¼€ä»“åº“
2. **æ•°æ®åº“å®‰å…¨**: ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨åªè¯»è´¦å·ï¼Œé™åˆ¶æŸ¥è¯¢æƒé™
3. **é€Ÿç‡é™åˆ¶**: å¤§æ¨¡å‹ API æœ‰è°ƒç”¨é™åˆ¶ï¼Œå»ºè®®æ·»åŠ é‡è¯•æœºåˆ¶
4. **æ•°æ®å‡†ç¡®æ€§**: SQL ç”Ÿæˆåå»ºè®®äººå·¥å®¡æ ¸å…³é”®æŸ¥è¯¢

---

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®å‚è€ƒå’Œä½¿ç”¨äº†ä»¥ä¸‹ä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼š

- **[n8n](https://github.com/n8n-io/n8n)** - å·¥ä½œæµè‡ªåŠ¨åŒ–å·¥å…· (MIT License)
- **[Vanna AI](https://github.com/vanna-ai/vanna)** - Text2SQL æ¡†æ¶ (MIT License)
- **[LangChain](https://github.com/langchain-ai/langchain)** - LLM åº”ç”¨æ¡†æ¶ (MIT License)
- **[é˜¿é‡Œäº‘ç™¾ç‚¼](https://bailian.console.aliyun.com/)** - å¤§æ¨¡å‹æœåŠ¡å¹³å°
- **[Qwen](https://github.com/QwenLM/Qwen)** - é€šä¹‰åƒé—®å¤§æ¨¡å‹

æ„Ÿè°¢è¿™äº›ä¼˜ç§€é¡¹ç›®çš„å¼€æºè´¡çŒ®ï¼âœ¨

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub**: [@gaaiyun](https://github.com/gaaiyun)
- **é¡¹ç›®åœ°å€**: https://github.com/gaaiyun/text2sql-analysis

---

## ğŸ—“ï¸ æ›´æ–°æ—¥å¿—

### v0.1.0 (2026-02-26)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… æ”¯æŒ 5 å¤§æ ¸å¿ƒåœºæ™¯
- âœ… n8n å·¥ä½œæµé›†æˆ
- âœ… Vanna AI Text2SQL
- âœ… 5 ä¸ªåœºæ™¯æç¤ºè¯æ¨¡æ¿
- âœ… å®Œæ•´çš„æ–‡æ¡£å’Œé…ç½®æ¨¡æ¿

---

<div align="center">

**Made with â¤ï¸ by æ´¾è’™ + Gaaiyun**

[â¬† è¿”å›é¡¶éƒ¨](#text2sql-analysis-)

</div>
